# Redis Cluster Configuration for High-Performance Caching
#
# Large-scale systems architecture:
# - Redis Cluster: Used for distributed caching with failover and high availability
# - Kafka: Used for message queuing and event streaming
# - This configuration focuses on caching only

# =================================
# REDIS CONNECTION SETTINGS
# =================================

# Redis Server URL (standalone mode - for development only)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_USERNAME=
REDIS_PASSWORD=
REDIS_DB_NUMBER=0

# =================================
# REDIS CLUSTER SETTINGS (Production)
# =================================

# Enable cluster mode (REQUIRED for production)
REDIS_CLUSTER_MODE=true

# Redis cluster node addresses (comma-separated)
# Minimum 3 nodes recommended for proper failover
# Format: "host1:port1,host2:port2,host3:port3"
REDIS_CLUSTER_ADDRS=redis-node1:6379,redis-node2:6379,redis-node3:6379,redis-node4:6379,redis-node5:6379,redis-node6:6379

# Cluster authentication
REDIS_USERNAME=
REDIS_PASSWORD=your_cluster_password

# =================================
# CACHE CONFIGURATION
# =================================

# Default cache TTL (Time To Live) in seconds
CACHE_DEFAULT_TTL=1800

# Cache key prefix for namespace isolation
CACHE_KEY_PREFIX=fiber_app

# Cache size limits (for memory management)
CACHE_MAX_MEMORY=2gb
CACHE_EVICTION_POLICY=allkeys-lru

# Cache performance settings
CACHE_COMPRESSION_ENABLED=true
CACHE_COMPRESSION_LEVEL=6
CACHE_PIPELINING_ENABLED=true

# =================================
# SESSION CONFIGURATION
# =================================

# Session storage prefix
SESSION_PREFIX=session

# Session expiration time (in hours)
SESSION_EXPIRATION_HOURS=24

# Session cookie settings
SESSION_COOKIE_NAME=session_id
SESSION_COOKIE_HTTP_ONLY=true
SESSION_COOKIE_SECURE=false  # Set to true in production with HTTPS
SESSION_COOKIE_SAME_SITE=Lax

# =================================
# RATE LIMITING CONFIGURATION
# =================================

# Rate limit window (in seconds)
RATE_LIMIT_WINDOW=3600

# Maximum requests per window
RATE_LIMIT_MAX_REQUESTS=1000

# Rate limit key prefix
RATE_LIMIT_PREFIX=ratelimit

# =================================
# MESSAGE QUEUING NOTICE
# =================================
# Message queuing is handled by Apache Kafka in production systems
# Redis is used only for high-performance caching
#
# For Kafka configuration, see separate kafka.env file

# =================================
# REDIS CLUSTER MONITORING & HEALTH
# =================================

# Health check interval (in seconds)
REDIS_HEALTH_CHECK_INTERVAL=30

# Enable Redis metrics collection for monitoring
REDIS_METRICS_ENABLED=true

# Redis slow log settings (microseconds)
REDIS_SLOW_LOG_THRESHOLD=10000

# Connection pool monitoring
REDIS_POOL_MONITORING_ENABLED=true

# =================================
# ENVIRONMENT SPECIFIC SETTINGS
# =================================

# Application environment (dev, staging, prod)
APP_ENV=prod

# Enable detailed logging for cluster operations
REDIS_CLUSTER_LOG_ENABLED=true

# =================================
# REDIS SECURITY (Production)
# =================================

# Redis TLS/SSL settings (recommended for production)
REDIS_TLS_ENABLED=true
REDIS_TLS_CERT_FILE=/path/to/redis-cert.pem
REDIS_TLS_KEY_FILE=/path/to/redis-key.pem
REDIS_TLS_CA_FILE=/path/to/ca-cert.pem

# Security settings
REDIS_REQUIRE_AUTH=true
REDIS_ACL_ENABLED=true

# =================================
# CLUSTER PERSISTENCE & BACKUP
# =================================

# Redis cluster persistence (important for cache recovery)
REDIS_PERSISTENCE_MODE=RDB_AOF

# RDB snapshot settings
REDIS_RDB_ENABLED=true
REDIS_RDB_SAVE_SECONDS=900  # Save if at least 1 key changed in 900s
REDIS_RDB_SAVE_CHANGES=1

# AOF settings for durability
REDIS_AOF_ENABLED=true
REDIS_AOF_SYNC_MODE=everysec
REDIS_AOF_REWRITE_PERCENTAGE=100
REDIS_AOF_REWRITE_MIN_SIZE=64mb

# =================================
# PRODUCTION CLUSTER OPTIMIZATION
# =================================

# Cluster failover settings
REDIS_CLUSTER_NODE_TIMEOUT=15000  # milliseconds
REDIS_CLUSTER_REPLICA_VALIDITY_FACTOR=10
REDIS_CLUSTER_MIGRATION_BARRIER=1

# Memory optimization for caching
REDIS_MAXMEMORY_POLICY=allkeys-lru
REDIS_MAXMEMORY_SAMPLES=5

# Network optimization
REDIS_TCP_KEEPALIVE=300
REDIS_TCP_BACKLOG=511